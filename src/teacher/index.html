<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>선생님 대시보드</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <link rel="stylesheet" href="/src/shared/style.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body class="bg-slate-50">

  <div id="toast-notification" class="fixed top-8 right-8 z-[100] p-4 rounded-lg shadow-lg text-white transform translate-x-[120%] opacity-0" style="transition: opacity 0.3s, transform 0.3s;">
    <p id="toast-message"></p>
  </div>

  <div id="teacher-login-container" class="w-full min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-xs mx-auto p-8 bg-white rounded-xl shadow-md">
      <h1 class="text-3xl font-bold text-slate-800 mb-6 text-center">교사/관리자 로그인</h1>
      <div class="space-y-4 text-left">
        <div>
          <label for="teacher-name" class="block text-sm font-medium text-slate-700 mb-1">이름</label>
          <input type="text" id="teacher-name" class="form-input" placeholder="이름을 입력하세요">
        </div>
        <div>
          <label for="teacher-password" class="block text-sm font-medium text-slate-700 mb-1">비밀번호</label>
          <input type="password" id="teacher-password" class="form-input" placeholder="비밀번호를 입력하세요">
        </div>
      </div>
      <button id="teacher-login-btn" class="btn-primary w-full mt-6 py-3">로그인</button>
      <a href="/" class="back-to-portal-btn mt-4 block text-center text-sm text-slate-500 hover:underline no-underline">포털로 돌아가기</a>
    </div>
  </div>

  <div id="teacher-dashboard-container" style="display:none;">
    <div class="container mx-auto max-w-5xl p-4 sm:p-6 md:p-8">
      <a href="/" class="back-to-portal-btn mb-8 inline-block text-sm text-slate-500 hover:text-slate-800 transition no-underline">&larr; 포털로 돌아가기</a>

      <div class="content-card">
        <header class="border-b border-slate-200 pb-6 mb-6">
          <label for="teacher-class-select" class="block text-sm font-medium text-slate-700 mb-2">반 선택</label>
          <select id="teacher-class-select" class="form-select max-w-sm">
            <option value="">-- 반 목록을 불러오는 중... --</option>
          </select>
        </header>

        <div id="teacher-main-content" style="display:none;">
          <div id="teacher-navigation-buttons" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div data-view="homework-dashboard" class="teacher-nav-btn dashboard-card">
              <svg class="w-8 h-8 mb-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
              <h3>숙제 현황</h3>
            </div>
            <div data-view="qna-video-mgmt" class="teacher-nav-btn dashboard-card">
              <svg class="w-8 h-8 mb-2 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
              <h3>질문 영상</h3>
            </div>
            <div data-view="lesson-mgmt" class="teacher-nav-btn dashboard-card">
              <svg class="w-8 h-8 mb-2 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
              <h3>학습 관리</h3>
            </div>
            <div data-view="student-list-mgmt" class="teacher-nav-btn dashboard-card">
              <svg class="w-8 h-8 mb-2 text-cyan-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"></path></svg>
              <h3>학생 명단 관리</h3>
            </div>
            <div data-view="class-mgmt" class="teacher-nav-btn dashboard-card">
              <svg class="w-8 h-8 mb-2 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
              <h3>반 설정</h3>
            </div>
            <div data-view="class-video-mgmt" class="teacher-nav-btn dashboard-card" style="display:none;">
              <svg class="w-8 h-8 mb-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m9.75 0V9M9 7.5l3-3m0 0 3 3M12 4.5v12.75"></path></svg>
              <h3>수업 영상 관리</h3>
            </div>
          </div>

          <main>
            <div id="view-homework-dashboard" class="teacher-view" style="display:none;"></div>
            <div id="view-qna-video-mgmt" class="teacher-view" style="display:none;"></div>
            <div id="view-lesson-mgmt" class="teacher-view" style="display:none;"></div>

            <div id="view-student-list-mgmt" class="teacher-view" style="display:none;">
              <div id="teacher-student-list-container" class="border rounded-lg bg-white"></div>
            </div>

            <div id="view-class-mgmt" class="teacher-view" style="display:none;">
              <button class="back-to-teacher-menu btn btn-secondary btn-sm mb-4">&larr; 메뉴로</button>
              <h2 class="text-2xl font-bold text-slate-800 mb-4">반 설정 관리</h2>

              <div id="current-class-info" class="mb-6 p-4 border rounded-lg bg-slate-50" style="display:none;">
                <h3 class="font-semibold text-slate-700 mb-2">현재 반 설정 정보</h3>
                <p class="text-sm text-slate-600"><strong>반 유형:</strong> <span id="current-class-type">-</span></p>
                <div class="mt-2">
                  <p class="text-sm font-medium text-slate-600 mb-1"><strong>연결된 과목 및 교재:</strong></p>
                  <ul id="current-class-subjects-list" class="list-disc list-inside text-sm text-slate-600 pl-4">
                    <li>정보 로딩 중...</li>
                  </ul>
                </div>
              </div>

              <div class="flex flex-col sm:flex-row gap-4">
                <button id="teacher-edit-class-btn" class="btn-primary">반 특성/과목/교재 설정 변경</button>
                <button id="teacher-manage-subjects-textbooks-btn" class="btn-secondary">과목/교재 관리 (추가/삭제)</button>
              </div>
            </div>

            <div id="view-class-video-mgmt" class="teacher-view" style="display:none;"></div>
          </main>
        </div>
      </div>
    </div>
  </div>

  <div id="teacher-assign-homework-modal" class="modal-backdrop" style="display:none;"></div>
  <div id="teacher-new-lesson-modal" class="modal-backdrop" style="display:none;"></div>

  <div id="teacher-edit-class-modal" class="modal-backdrop" style="display:none;">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col">
      <header class="p-6 border-b flex items-center justify-between">
        <h2 class="text-2xl font-bold text-slate-800">
          반 설정 수정: <span id="teacher-edit-class-name">-</span>
        </h2>
        <button id="teacher-close-edit-class-modal-btn" class="text-2xl font-light text-slate-500 hover:text-slate-800">&times;</button>
      </header>

      <main class="p-6 flex-grow overflow-y-auto custom-scrollbar space-y-6">
        <section>
          <label for="teacher-edit-class-type" class="block text-sm font-medium text-slate-700 mb-2">반 유형</label>
          <select id="teacher-edit-class-type" class="form-select max-w-xs">
            <option value="self-directed">자기주도반</option>
            <option value="live-lecture">현강반</option>
          </select>
        </section>

        <section>
          <h3 class="text-lg font-semibold text-slate-700 mb-3">과목 및 교재 선택</h3>
          <p class="text-sm text-slate-500 mb-2">과목을 체크하면 하위에 교재 목록이 표시됩니다.</p>
          <div id="teacher-edit-class-subjects-and-textbooks" class="space-y-3"></div>
        </section>
      </main>

      <footer class="p-6 border-t flex gap-3 justify-end">
        <button id="teacher-cancel-edit-class-btn" class="btn-secondary">취소</button>
        <button id="teacher-save-class-edit-btn" class="btn-primary">저장</button>
      </footer>
    </div>
  </div>

  <div id="teacher-subject-textbook-mgmt-modal" class="modal-backdrop" style="display:none;">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col">
      <header class="p-6 border-b flex justify-between items-center">
        <h2 class="text-2xl font-bold text-slate-800">과목 및 교재 관리</h2>
        <button id="teacher-close-subject-textbook-modal-btn" class="text-2xl font-light text-slate-500 hover:text-slate-800">&times;</button>
      </header>
      <main class="p-6 flex-grow overflow-y-auto custom-scrollbar grid grid-cols-1 md:grid-cols-2 gap-8">
        <div>
          <h3 class="text-lg font-semibold text-slate-700 mb-4 border-b pb-2">과목 관리</h3>
          <div class="flex items-end gap-4 mb-4">
            <div class="flex-grow">
              <label for="teacher-new-subject-name" class="block text-sm font-medium text-slate-700 mb-1">새 과목 이름</label>
              <input type="text" id="teacher-new-subject-name" class="form-input form-input-sm" placeholder="예: 공통 과학">
            </div>
            <div class="flex-shrink-0">
              <button id="teacher-add-subject-btn" class="btn-primary btn-sm">+ 과목 추가</button>
            </div>
          </div>
          <h4 class="text-md font-semibold text-slate-600 mb-2">과목 목록</h4>
          <div id="teacher-subjects-list-mgmt" class="space-y-2 max-h-60 overflow-y-auto custom-scrollbar border p-2 rounded-md">
            <p class="text-sm text-slate-400">과목 목록 로딩 중...</p>
          </div>
        </div>
        <div>
          <h3 class="text-lg font-semibold text-slate-700 mb-4 border-b pb-2">교재 관리</h3>
          <div class="mb-4">
            <label for="teacher-subject-select-for-textbook-mgmt" class="block text-sm font-medium text-slate-700 mb-1">과목 선택</label>
            <select id="teacher-subject-select-for-textbook-mgmt" class="form-select form-select-sm"></select>
          </div>
          <div id="teacher-textbook-management-content" style="display:none;">
            <div class="flex items-end gap-4 mb-4">
              <div class="flex-grow">
                <label for="teacher-new-textbook-name" class="block text-sm font-medium text-slate-700 mb-1">새 교재 이름</label>
                <input type="text" id="teacher-new-textbook-name" class="form-input form-input-sm" placeholder="예: 과학의 정석">
              </div>
              <div class="flex-shrink-0">
                <button id="teacher-add-textbook-btn" class="btn-primary btn-sm">+ 교재 추가</button>
              </div>
            </div>
            <h4 class="text-md font-semibold text-slate-600 mb-2">교재 목록</h4>
            <div id="teacher-textbooks-list-mgmt" class="space-y-2 max-h-60 overflow-y-auto custom-scrollbar border p-2 rounded-md">
              <p class="text-sm text-slate-400">과목을 선택해주세요.</p>
            </div>
          </div>
        </div>
      </main>
      <footer class="p-6 border-t flex justify-end">
        <button id="teacher-close-subject-textbook-modal-btn-footer" class="btn-secondary">닫기</button>
      </footer>
    </div>
  </div>

  <script type="module">
    import { TeacherApp } from '/src/teacher/teacherApp.js';
    if (TeacherApp?.init) {
      TeacherApp.init();
    } else {
      console.error('TeacherApp.init()가 없습니다. teacherApp.js export를 확인하세요.');
    }
  </script>
</body>
</html>