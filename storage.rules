rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    
    // [🚨🚨🚨 매우 심각한 보안 경고]
    // 학생이 숙제 파일(이미지 등)을 업로드해야 하므로 누구나(if true) 읽고 쓸 수 있게 허용합니다.
    // 이 규칙은 누구나 이 경로에 파일을 무제한 업로드할 수 있게 허용합니다. (비용 폭탄 위험)
    match /homeworks/{homeworkId}/{studentId}/{fileName} {
      allow read, write: if true;
    }

    // (교사/관리자가 사용하는 AI 채점 폴더는 인증된 사용자만 허용)
    match /homework-grading/{homeworkId}/{fileName} {
      allow read, write: if request.auth != null;
    }

    // (이 외의 모든 경로는 기본적으로 접근 거부)
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}