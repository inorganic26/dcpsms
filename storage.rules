rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {

    // [1] 선생님인지 확인하는 함수 (관리자 권한)
    function isTeacher() {
      return request.auth != null && request.auth.token.email == "inorganic26@gmail.com";
    }

    // [2] 숙제 제출 파일 규칙
    match /homework_submissions/{homeworkId}/{studentId}/{fileName} {
      allow read: if isTeacher() || request.auth.uid == studentId;
      allow write: if isTeacher() || request.auth.uid == studentId;
    }
    
    // [3] 일일 테스트 이미지: 인증된 학생이 자신의 폴더에 업로드 가능
    match /daily_test_images/{userId}/{fileName} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // [4] 주간 테스트 이미지: 인증된 학생이 자신의 폴더에 업로드 가능
    match /weekly_test_images/{userId}/{fileName} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == userId;
    }

    // [5] 그 외 모든 파일 (교재 PDF, 공지 이미지 등)
    match /{allPaths=**} {
      allow read, write: if isTeacher();
    }
  }
}