rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {

    // 1. 로그인 여부 확인 함수
    function isAuthenticated() {
      return request.auth != null;
    }

    // 2. [수정됨] 숙제 파일 제출 경로 허용
    // 학생 앱은 'homework_submissions' 폴더를 사용하므로 이 규칙이 반드시 필요합니다.
    match /homework_submissions/{allPaths=**} {
      allow read, write: if isAuthenticated();
    }

    // (참고) 혹시 모를 구버전 호환용
    match /homeworks/{allPaths=**} {
      allow read, write: if isAuthenticated();
    }

    // 3. [성적표 리포트] 관리자가 올리는 곳
    match /reports/{classId}/{date}/{fileName} {
      allow read, write: if isAuthenticated();
    }
    
    // 4. [기타] 그 외 모든 파일 (기본 차단)
    match /{allPaths=**} {
      allow read: if isAuthenticated();
      allow write: if false; 
    }
  }
}