rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // --- 모든 컬렉션에 대한 읽기/쓰기 권한을 'if true'로 설정 ---

    // teachers (교사 정보)
    match /teachers/{teacherId} {
      allow read, write: if true; 
    }
    
    // admins (관리자 정보)
    match /admins/{adminId} {
      allow read, write: if true; 
    }
    
    // homeworks 컬렉션 및 제출물
    match /homeworks/{homeworkId} {
      allow read, write: if true; 

      match /submissions/{studentId} {
        allow read, write: if true;
      }
    }

    // classLectures (현강반 수업 영상)
    match /classLectures/{lectureId} {
      allow read, write: if true; 
    }
    
    // classes (반 정보)
    match /classes/{classId} {
      allow read, write: if true;
    }
    
    // students (학생 정보)
    match /students/{studentId} {
      // list 권한은 isAuthenticated를 유지하나, read/write는 true로 설정
      allow read, write: if true; 
    }

    // subjects (과목 정보) 및 하위 컬렉션
    match /subjects/{subjectId} {
      allow read, write: if true; 

      match /lessons/{lessonId} {
        allow read, write: if true;

        match /submissions/{studentId} {
            allow read, write: if true;
        }
      }

      match /textbooks/{textbookId} {
        allow read, write: if true; 
      }
    }

    // 기타 모든 컬렉션에 대해 명시적 허용
    match /grading/{gradeId} { allow read, write: if true; }
    match /notices/{noticeId} { allow read, write: if true; }
    match /comments/{commentId} { allow read, write: if true; }
    match /messages/{messageId} { allow read, write: if true; }
    match /attendance/{recordId} { allow read, write: if true; }
    match /aiAnalysis/{analysisId} { allow read, write: if true; }
    match /analytics/{docId} { allow read, write: if true; }
    match /classVideos/{videoId} { allow read, write: if true; }


    // fallback (명시되지 않은 문서에 대한 기본 차단은 유지)
    match /{document=**} {
      allow read, write: if false;
    }
  }
}