rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // =========================================================================
    // 1. [공개] 반 목록 (Classes)
    // -------------------------------------------------------------------------
    // 학부모님이 로그인하기 전에도 '반 선택 드롭다운' 목록은 보여야 합니다.
    // 그래서 반 목록만큼은 누구나 읽을 수 있게(true) 열어둡니다.
    // =========================================================================
    match /classes/{classId} {
      allow read: if true;
      allow write: if request.auth != null;
    }

    // =========================================================================
    // 2. [비공개] 나머지 모든 데이터 (학생, 성적, 숙제, 영상 등)
    // -------------------------------------------------------------------------
    // 반 목록을 제외한 모든 데이터는 오직 '로그인한 사람(학생/학부모/선생님)'만
    // 접근할 수 있도록 철저하게 잠급니다. (보안 강화)
    // =========================================================================
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
    
  }
}